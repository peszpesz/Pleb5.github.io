{% assign current_lang = page.lang %}
{% if current_lang == nil %}
  {% if page.url contains '/en/' %}
    {% assign current_lang = 'en' %}
  {% elsif page.url contains '/hu/' %}
    {% assign current_lang = 'hu' %}
  {% else %}
    {% assign current_lang = site.default_language %}
  {% endif %}
{% endif %}
{% assign translations = site.data.translations %}

<div class="language-switcher">
  <label for="language-select">{{ translations.language_selector[current_lang] }}:</label>
  <select id="language-select" onchange="changeLanguage(this.value)">
    {% for lang in site.languages %}
      <option value="{{ lang }}" {% if lang == current_lang %}selected{% endif %}>
        {% case lang %}
          {% when 'en' %}
            English
          {% when 'hu' %}
            Magyar
        {% endcase %}
      </option>
    {% endfor %}
  </select>
</div>

<script>
function changeLanguage(lang) {
  const currentPath = window.location.pathname;
  const currentLang = '{{ current_lang }}';
  let newPath;
  
  // Remove current language prefix if it exists
  if (currentPath.startsWith('/' + currentLang + '/')) {
    newPath = currentPath.substring(currentLang.length + 1);
  } else if (currentPath === '/' + currentLang || currentPath === '/' + currentLang + '/') {
    newPath = '/';
  } else {
    newPath = currentPath;
  }
  
  // Add new language prefix if not default language
  if (lang !== '{{ site.default_language }}') {
    if (newPath === '/') {
      newPath = '/' + lang + '/';
    } else {
      newPath = '/' + lang + newPath;
    }
  } else {
    // For default language, prepend /en/
    if (newPath === '/') {
      newPath = '/en/';
    } else {
      newPath = '/en' + newPath;
    }
  }
  
  // Check if the page exists in the selected language
  // For now, we'll just redirect and let Jekyll handle 404s
  window.location.href = newPath;
}
</script>

<style>
.language-switcher {
  display: inline-block;
  margin-left: 1rem;
}

/* When in navigation sidebar */
.nav-language-switcher {
  padding: 1rem;
  margin-top: 2rem;
  border-top: 1px solid var(--color-border, #e1e4e8);
}

.nav-language-switcher .language-switcher {
  display: block;
  margin-left: 0;
}

/* When in header, align properly with search and aux links */
.main-header .language-switcher {
  display: inline-flex;
  align-items: center;
  margin-right: 1rem;
}

.language-switcher label {
  margin-right: 0.5rem;
  font-size: 0.875rem;
  color: var(--color-foreground, #333);
}

.language-switcher select {
  padding: 0.25rem 0.5rem;
  border: 1px solid var(--color-border, #ccc);
  border-radius: 4px;
  background-color: var(--color-background, #fff);
  color: var(--color-foreground, #333);
  font-size: 0.875rem;
  cursor: pointer;
  width: 100%;
  max-width: 200px;
}

/* Dark theme support */
[data-theme="dark"] .language-switcher select,
.dark-mode .language-switcher select {
  background-color: #2f3136;
  color: #e3e5e8;
  border-color: #40444b;
}

[data-theme="dark"] .nav-language-switcher,
.dark-mode .nav-language-switcher {
  border-top-color: #40444b;
}

/* Mobile responsive */
@media (max-width: 768px) {
  .main-header .language-switcher {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
  }
}
</style>
